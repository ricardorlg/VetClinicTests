name: Build and run tests

on: [push, pull_request, workflow_dispatch]
permissions:
  contents: write

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
        - uses: actions/checkout@v4
        - name: Set up Java 21
          uses: actions/setup-java@v4
          with:
            distribution: 'temurin'
            java-version: '21'
            cache: maven

        - name: Build and test
          run: mvn -B clean verify

        - name: Upload test results
          if: github.ref == 'refs/heads/main'
          uses: JamesIves/github-pages-deploy-action@v4
          with:
            folder: target/site/serenity


